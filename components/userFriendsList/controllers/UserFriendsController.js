// Generated by CoffeeScript 1.7.1
'use strict';
UserFriendsModule.controller('UserFriendsController', function($scope, $location, $state, $timeout, $stateParams, Notification, Static, RestModel, Loader, LocalStorage, params, currentUser) {
  $scope.stateParams = $stateParams;
  $scope.window = window;
  $scope.params = params;
  Static.params = params;
  $scope.hideUsers = [];
  $scope.page = 1;
  $scope.pageSize = 50;
  $scope.userId = $scope.stateParams.userId;
  $scope.currentUser = currentUser;
  $scope.loading = true;
  $scope.resultUserFriends = false;
  $scope.back = function() {
    return $scope.window.history.back();
  };
  $scope.home = function() {
    return $state.transitionTo('friends');
  };
  $scope.userFriendsArray = null;
  RestModel.getFriends(params, $scope.userId).then(function(data) {
    $scope.loading = false;
    $scope.countFriends = data.response.count;
    $scope.userFriends = RestModel.isWorkingFriendsObject(data);
    return $scope.userFriendsArray = null;
  }, function(error) {
    return Notification.error(error);
  });
  $scope.getFriendsWhoHideYour = function() {
    var count, listFriends;
    $scope.loading = true;
    count = $scope.userFriends.length;
    listFriends = angular.copy($scope.userFriends);
    listFriends = RestModel.friendsOnlineOrDelete(null, listFriends);
    return Static.getHideFriendsList(count, listFriends, $scope.userId, []).then(function(result) {
      $scope.resultHide = result;
      if ($scope.resultHide.length === 0) {
        Notification.show('Скорее всего пользователя никто не скрывает');
        return $scope.loading = false;
      } else {
        return Static.getFriends($scope.resultHide, []).then(function(users) {
          $scope.loading = false;
          $scope.hideUsers = users;
          $scope.openTableOnline = false;
          return $scope.openTable = false;
        }, function(error) {
          return Notification.error(error);
        });
      }
    }, function(error) {
      return Notification.error(error);
    });
  };
  $scope.getListFriendsOnlineOrDelete = function(type) {
    $scope.hideUsers = [];
    return $scope.userFriendsArray = RestModel.friendsOnlineOrDelete(type, $scope.userFriends);
  };
  $scope.getListFriends = function() {
    $scope.hideUsers = [];
    return $scope.userFriendsArray = null;
  };
  $scope.more = function(user) {
    LocalStorage.setItem('last', user.last_seen);
    return $state.transitionTo('user', {
      userId: user.id || user.uid
    });
  };
  return $scope.getStatisticPage = function() {
    return $state.transitionTo('statistics', {
      userId: $scope.userId
    });
  };
});

//# sourceMappingURL=UserFriendsController.map
